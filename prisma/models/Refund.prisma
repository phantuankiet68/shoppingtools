enum RefundStatus {
  PENDING
  APPROVED
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELLED
}

enum RefundReason {
  CUSTOMER_REQUEST
  DAMAGED
  WRONG_ITEM
  NOT_RECEIVED
  CANCELLED_ORDER
  DUPLICATE_PAYMENT
  OTHER
}

model Refund {
  id        String       @id @default(cuid())

  userId    String
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  // keep as plain ids (no relations)
  orderId           String?
  originalPaymentId String?
  refundPaymentId   String?  @unique

  status    RefundStatus @default(PENDING)
  reason    RefundReason @default(OTHER)

  amountCents Int
  currency  CurrencyCode @default(VND)

  reference String?
  notes     String?

  requestedAt DateTime @default(now())
  approvedAt  DateTime?
  processedAt DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, createdAt])
  @@index([orderId, createdAt])
  @@index([status, createdAt])
  @@index([reason, createdAt])
}

model RefundItem {
  id        String  @id @default(cuid())

  // keep as plain ids (no relations)
  refundId   String?
  orderItemId String?

  qty         Int     @default(1)
  amountCents Int     @default(0)
  notes       String?

  @@index([refundId])
  @@index([orderItemId])
}
