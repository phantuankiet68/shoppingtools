
model FileFolder {
  id         String      @id @default(cuid())
  name       String

  // Tree
  parentId   String?
  parent     FileFolder? @relation("FolderTree", fields: [parentId], references: [id], onDelete: Cascade)
  children   FileFolder[] @relation("FolderTree")

  // Ownership (map vào User.folders)
  ownerId    String
  owner      User         @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  // Files inside folder
  files      StoredFile[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([ownerId, parentId])
  // chống trùng tên folder trong cùng 1 thư mục (theo user)
  @@unique([ownerId, parentId, name])
}

model StoredFile {
  id         String   @id @default(cuid())

  folderId   String?
  folder     FileFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)

  // Ownership (map vào User.files)
  ownerId    String
  owner      User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  name       String
  mimeType   String
  sizeBytes  Int
  storageKey String   @unique  // key để tìm file trong storage private

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([ownerId, folderId])
  @@index([folderId])
}
